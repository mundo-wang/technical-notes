`IPv4`协议全称为`Internet Protocol version 4`，是互联网协议的第四个版本，也是当前使用最广泛的网络协议。

`IPv4`的地址是`32`位的二进制数字，通常将`32`位二进制数字分为`4`组，每组`8`位（一个字节），然后将每个字节都转换成十进制数，组和组之间通过`.`来分隔。例如一个`IPv4`的地址可能是`192.168.1.1`。

`IPv4`的地址范围从`0.0.0.0`到`255.255.255.255`，总共可以提供`2`的`32`次幂，也就是约`43`亿个地址。

#### 1. 公有地址

在互联网（公有网络）中，`IPv4`地址是完全不允许重复的。每一个公有`IPv4`地址必须是唯一的，确保全球范围内的每个联网设备都可以通过其独特的`IP`地址进行通信。因此，在公有网络中，`IPv4`地址的分配通常由`ISP`（互联网服务提供商）或专门的机构（如`IANA`和`RIR`）进行，以确保全球唯一性。

#### 2. 私有地址

在私有网络（局域网）中，同一网段内的`IPv4`地址必须是唯一的。每台设备都应拥有一个独立的`IPv4`地址，以确保路由器或交换机能够正确转发数据包，实现正常的网络通信。

如果同一网段内存在重复的`IP`地址，会导致`IP`冲突，进而引发以下问题：

- 设备无法访问网络，因为路由器无法区分数据包的目标设备。
- 数据包丢失或混乱，可能导致部分设备间歇性掉线。
- 无法正常访问局域网内的资源，如打印机、服务器或共享文件夹。

根据`RFC 1918`标准，私有网络使用以下`IPv4`地址范围：

| **地址范围**                    | **子网掩码**          | **适用场景**               |
| ------------------------------- | --------------------- | -------------------------- |
| `10.0.0.0 – 10.255.255.255`     | `255.0.0.0` (`/8`)    | 适用于大型企业网络         |
| `172.16.0.0 – 172.31.255.255`   | `255.240.0.0` (`/12`) | 适用于中型企业网络         |
| `192.168.0.0 – 192.168.255.255` | `255.255.0.0` (`/16`) | 适用于家庭、小型办公室网络 |

这些地址不能直接在公网（互联网）使用，必须通过`NAT`（网络地址转换）才能访问外部网络。

#### 3. 特殊地址

- 回环地址（`Loopback Address`）：`127.0.0.0/8`，通常使用`127.0.0.1`，用于测试本地计算机的网络功能。
- 有限广播地址（`Limited Broadcast Address`）：为`255.255.255.255`，只能在本地网络（或子网）内使用，不能通过路由器传递到其他子网。它用于在本地网络中向所有主机发送广播消息，通常在启动时用于发现其他主机或设备。
- 定向广播地址（`Directed Broadcast Address`）：形式是网络地址中主机部分全为`1`。例如，对于网络地址`123.60.188.152`，子网掩码为`255.255.255.0`（即`123.60.188.152/24`），其定向广播地址为`123.60.188.255`。这种地址用于向特定子网中的所有主机发送广播消息，并且可以通过路由器传递到目标子网。

#### 4. 子网掩码

子网掩码是网络中用于划分`IP`地址的网络部分和主机部分的工具。它决定了一个`IP`地址属于哪个网络。子网掩码也是一个`32`位的二进制数，由连续的`1`和连续的`0`组成：

- 连续的`1`表示网络部分，所有属于同一网络的设备在`IP`地址的网络部分相同。
- 连续的`0`表示主机部分，主机部分用于标识同一网络内的不同设备。

子网掩码通常也是以十进制点分表示法表示，例如`255.255.255.0`，它的二进制表示为`11111111.11111111.11111111.00000000`。这意味着该子网掩码的网络位数为`24`位，主机位数为`8`位。

通过将`IP`地址与子网掩码进行按位与运算，可以得到该`IP`地址所属的网络地址。

子网掩码可以决定一个子网内可以分配给主机的`IP`地址数量，通过计算主机部分的位数得到：

```scss
可用主机数量 = 2^(主机位数) - 2
```

其中，减去的`2`是因为每个子网的第一个地址是网络地址，最后一个地址是定向广播地址，不能分配给主机使用。

子网掩码的`1`越多，网络部分就越大，主机部分就越小。这意味着网络可以包含更多的子网，但每个子网内的主机数量较少。相反，子网掩码的`0`越多，主机部分越大，网络部分越小，这意味着一个网络可以包含更多的主机。

#### 5. `CIDR`表示法

子网掩码也可以用无类域间路由（`CIDR`）表示法表示，并直接写到`IPv4`对应的网络地址后面，格式如下：

```sh
<IP地址>/<前缀长度>
```

例如以下子网掩码和`CIDR`表示法的关系：

| `CIDR`表示法 | 子网掩码          | `1`的位数 | 可用主机数                       |
| ------------ | ----------------- | --------- | -------------------------------- |
| `/16`        | `255.255.0.0`     | `16`      | `2^16 - 2 = 65534`               |
| `/24`        | `255.255.255.0`   | `24`      | `2^8 - 2 = 254`                  |
| `/26`        | `255.255.255.192` | `26`      | `2^6 - 2 = 62`                   |
| `/32`        | `255.255.255.255` | `32`      | `2^0 - 2 = 0` (仅可指向单一主机) |

例如，`IPv4`地址为`133.60.184.112`，其子网掩码为`255.255.255.0`，对应的`CIDR`表示法为`133.60.184.112/24`。实际上，该表示方式与`133.60.184.0/24`是等效的，因为两者都表示同一个`/24`子网范围：

```go
func main() {
	_, ipnet1, _ := net.ParseCIDR("133.60.184.0/24")
	_, ipnet2, _ := net.ParseCIDR("133.60.184.112/24")

	fmt.Println(ipnet1.String()) // 输出：133.60.184.0/24
	fmt.Println(ipnet2.String()) // 也输出：133.60.184.0/24
}
```

它们的含义都是：以`133.60.184.0`为起始地址、掩码为`/24`的一个子网段，可表示连续的`254`个主机地址。通常，标准写法是使用网络地址`133.60.184.0`作为前缀，但使用该子网内的任意`IP`地址加上`/24`，也是合法且等效的表示方式。