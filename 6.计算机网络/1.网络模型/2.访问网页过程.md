当我们在浏览器地址栏输入`URL`并访问网页时，从输入开始到页面成功渲染，会依次经历若干关键阶段。

#### 1. 输入`URL`并解析

用户在浏览器的地址栏中输入一个`URL`，浏览器首先会对这个`URL`进行解析：

1. 检查是否是有效的`URL`格式。例如`https://www.example.com`是正确的，而`htp:/example`是不合法的。
2. 浏览器可能会补全`URL`。例如，输入`example.com`，浏览器会自动为其加上`https://`前缀。
3. 如果用户输入的是一个搜索关键词（如“天气”），而不是`URL`，浏览器会将其发送到默认的搜索引擎。
4. 浏览器检查本地缓存，看看是否已经访问过该页面，并且是否可以使用缓存的资源来加载页面。

#### 2. `DNS`（域名系统）解析

`DNS`负责将人类可读的域名`www.example.com`转换为服务器的`IP`地址`123.60.188.152`。具体过程如下：

1. 检查本地缓存：浏览器会优先查找自身的`DNS`缓存，若未命中，则继续查询操作系统的`DNS`缓存（`/etc/hosts`文件）。
2. 查询本地`DNS`服务器：如果操作系统缓存中没有记录，浏览器会向本地`DNS`服务器（通常由`ISP`提供）发起请求。
3. 递归解析域名：当本地`DNS`服务器没有目标域名的缓存时，它会向根`DNS`服务器发起查询。根`DNS`服务器会指向对应的顶级域`TLD`服务器（例如处理`.com`的`TLD`）。随后，`TLD`服务器会返回该域名的权威`DNS`服务器地址（例如`example.com`的权威`DNS`）。最终，权威`DNS`服务器接收到查询请求，返回该域名对应的`IP`地址。
4. 返回`IP`地址：`DNS`解析完成后，浏览器获得目标服务器的`IP`地址`123.60.188.152`。

在`DNS`解析过程中，可能会涉及多种负载均衡机制，例如轮询负载均衡、基于地理位置的`GeoDNS`、`Anycast`路由以及`CDN`负载均衡，用于优化访问速度并合理分配网络流量。

#### 3. 建立网络连接（`TCP`与`SSL/TLS`）

获得`IP`地址后，浏览器通过`TCP`协议与服务器建立连接，三次握手的流程如下：

- 第一次握手：客户端请求建立连接，发送一个`SYN`报文。

- 第二次握手：服务端响应连接，发送一个`SYN+ACK`报文，确认收到客户端的`SYN`。

- 第三次握手：客户端确认服务端的`SYN`，并发送`ACK`报文确认。

如果访问的是`HTTPS`网站，还需要进行`SSL/TLS`握手来建立加密通信。

#### 4. 发送`HTTP`请求

`TCP`连接建立后，浏览器向服务器发送`HTTP`请求，通常是`GET`请求。请求内容包括请求行、请求头等内容。

#### 5. 服务器处理请求并响应

浏览器发起`HTTP`请求后，请求会先到达服务器入口层的`Nginx`。根据`nginx.conf`配置，`Nginx`会对请求进行匹配与路由：

1. 如果请求指向`index.html`等静态资源，`Nginx`会直接从本地静态目录读取文件，并将其内容写入`HTTP`响应体进行返回。

2. 如果是接口请求，`Nginx`会将其反向代理至后端应用服务器，由相应接口处理并返回响应。

#### 6. 浏览器接收`HTTP`响应并渲染页面

浏览器在接收并解析服务器返回的`HTTP`响应后，会依次执行以下操作：首先检查响应状态码，然后解析响应头，接着进入渲染流程。浏览器会解析响应体中的`HTML`、`CSS`和`JavaScript`内容，并将其渲染为页面。

#### 7. 页面加载中的资源请求

在`HTML`中，`<img>`、`<script>`和`<link>`标签会触发额外的`HTTP`请求。此外，`JavaScript`还可能通过动态方式加载新资源，例如使用`AJAX`请求或`fetch`接口。浏览器通常会对部分资源进行缓存，以提升页面加载性能和响应速度。

#### 8. 结束`TCP`连接

如果服务器启用了`Keep-Alive`，`TCP`连接可能会保持一段时间，以便后续请求复用。 否则，连接会经过四次挥手关闭：

- 第一次挥手：客户端发送`FIN`报文，表示客户端没有数据要发送了，想关闭连接。
- 第二次挥手：服务端收到`FIN`后，发送`ACK`报文段进行确认。
- 第三次挥手：服务端再发送自己的`FIN`，表示服务端也准备关闭连接。
- 第四次挥手：客户端收到`FIN`后，发送`ACK`进行确认，然后进入`TIME_WAIT`状态。
