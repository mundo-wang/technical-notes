当我们在浏览器中输入一个网址并访问网页时，从输入`URL`开始，到页面最终在浏览器中渲染完成，涉及到以下的几个步骤：

#### 1. 输入`URL`并解析

用户在浏览器的地址栏中输入一个`URL`（例如`https://www.example.com`），浏览器首先会对这个`URL`进行解析：

1. 检查是否是有效的`URL`格式。例如`https://www.example.com`是正确的，而`htp:/example`是不合法的。
2. 浏览器可能会补全`URL`。例如，输入`example.com`，浏览器可能会自动加上`https://`。
3. 如果用户输入的是一个搜索关键词（如“天气”），而不是`URL`，浏览器会将其发送到默认的搜索引擎。
4. 浏览器检查本地缓存，看看是否已经访问过该页面，并且是否可以使用缓存的资源来加载页面。

#### 2. `DNS`解析

`DNS`（域名系统）负责将人类可读的域名（如`www.example.com`）转换为服务器的`IP`地址（如`123.60.188.152`）。

`DNS`解析的具体过程如下：

1. 检查本地缓存：浏览器会优先查找自身的`DNS`缓存，若未命中，则继续查询操作系统的`DNS`缓存（如`/etc/hosts`文件）。
2. 查询本地`DNS`服务器：如果操作系统缓存中没有记录，浏览器会向本地`DNS`服务器（通常由`ISP`提供）发起请求。
3. 递归解析域名：当本地`DNS`服务器没有目标域名的缓存记录时，它会向根`DNS`服务器发起查询。根`DNS`服务器会返回相应的顶级域名（`TLD`）服务器（例如`.com`域名的`TLD`服务器）。随后，`TLD`服务器会提供该域名的权威`DNS`服务器地址（例如`example.com`的权威`DNS`服务器）。最终，权威`DNS`服务器返回该域名对应的`IP`地址。
4. 在`DNS`解析过程中，可能会涉及负载均衡机制，例如轮询负载均衡、基于地理位置的`GeoDNS`、`Anycast`路由以及`CDN`负载均衡，以优化访问速度和分配流量。
5. 返回`IP`地址：`DNS`解析完成后，浏览器获得目标服务器的`IP`地址（如`123.60.188.152`）。

#### 3. 建立网络连接（`TCP`与`SSL/TLS`）

获得`IP`地址后，浏览器与服务器建立连接，通常采用`TCP`协议，并可能涉及`SSL/TLS`加密。

`HTTP`协议通常基于`TCP`，所以浏览器会与服务器建立`TCP`连接：

1. 客户端发送`SYN`：浏览器向服务器发送`SYN`（同步）请求，表示要建立连接。
2. 服务器返回`SYN-ACK`：服务器收到请求后，返回`SYN-ACK`给浏览器，表示同意建立连接。
3. 客户端发送`ACK`：浏览器回复`ACK`给服务器，连接建立完成。

如果访问的是`HTTPS`网站，还需要进行`SSL/TLS`握手来建立加密通信。

#### 4. 发送`HTTP`请求

`TCP`连接建立后，浏览器发送`HTTP`请求，通常是`GET`请求。请求内容包括请求行、请求头、请求体（仅`POST`请求）。

#### 5. 服务器处理请求并响应

服务器收到`HTTP`请求后，会进行如下处理：

1. 检查`URL`路径：根据`URL`找到对应的资源或后端服务。
2. 检查权限：验证用户是否有权限访问该资源（如身份验证）。
3. 执行后端逻辑：可能涉及数据库查询、数据处理等。
4. 生成`HTTP`响应，包括状态码、响应头、响应体（如`HTML`网页数据）。

#### 6. 浏览器接收`HTTP`响应

服务器发送`HTTP`响应后，浏览器会接收并解析。首先，浏览器检查响应的状态码，然后解析响应头，随后进入渲染流程。

#### 7. 浏览器解析并渲染页面

浏览器解析响应体中的`HTML`、`CSS`和`JavaScript`，并渲染页面。

#### 8. 页面加载中的资源请求

`HTML`中的`<img>`、`<script>`、`<link>`标签会触发额外的`HTTP`请求。此外，`JavaScript`可能会动态加载新的资源（如`AJAX`请求或`fetch`）。浏览器还会缓存一些资源，以提高性能。

#### 9. 结束`TCP`连接

如果服务器启用了`Keep-Alive`，`TCP`连接可能会保持一段时间，以便后续请求复用。 否则，连接会经过四次挥手关闭：

1. 客户端发送`FIN`，请求断开连接。
1. 服务器返回`ACK`，确认收到。
1. 服务器发送`FIN`，表示准备关闭。
1. 客户端返回`ACK`，连接关闭。
