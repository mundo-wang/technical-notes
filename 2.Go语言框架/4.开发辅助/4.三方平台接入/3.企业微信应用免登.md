企业微信内部应用的登录流程与钉钉`H5`微应用相似，其关键概念如下：



我们的后端服务需要新建以下两张表：

```sql
CREATE TABLE `wecom_app_config` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `app_code` VARCHAR(64) NOT NULL DEFAULT '' COMMENT '后端自定义的企微应用标识',
  `corp_id` VARCHAR(128) NOT NULL COMMENT '企微企业唯一id',
  `agent_id` VARCHAR(128) NOT NULL COMMENT '企业内部应用唯一id',
  `corp_secret` VARCHAR(256) NOT NULL COMMENT '应用级别的独立访问密钥',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_code` (`app_code`),
  UNIQUE KEY `uk_corp_agent` (`corp_id`, `agent_id`)    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='企微应用配置表';

CREATE TABLE `wecom_app_user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `app_code` VARCHAR(64) NOT NULL COMMENT '后端自定义的企微应用标识，关联wecom_app_config.app_code',
  `user_id` BIGINT NOT NULL COMMENT '用户ID, 关联sys_user.id',
  `user_name` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '用户名，关联sys_user.name',
  `wecom_user_id` VARCHAR(64) NOT NULL COMMENT '企微用户的userId',
  `wecom_avatar` VARCHAR(128) NOT NULL DEFAULT '' COMMENT '企微用户头像',
  `wecom_qr_code` VARCHAR(128) NOT NULL DEFAULT '' COMMENT '企微员工个人二维码',
  `wecom_mobile` VARCHAR(20) NOT NULL COMMENT '企微手机号码',
  `wecom_openid` VARCHAR(64) NOT NULL DEFAULT '' COMMENT '企微用户的openid',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='企微应用用户登录记录表';
```

