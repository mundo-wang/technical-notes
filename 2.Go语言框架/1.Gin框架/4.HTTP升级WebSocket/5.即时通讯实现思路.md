`WebSocket`的一个典型应用场景就是即时通讯。下面以单聊和群聊为例，介绍即时通讯的实现思路。

在使用`WebSocket`进行即时通讯时，用户`A`与用户`B`之间并不会直接建立连接。二者各自与`WebSocket`服务器保持连接。当用户`A`需要向用户`B`发送消息时，消息会先发送至`WebSocket`服务器，再由服务器转发给用户`B`。

在代码实现中，我们需要维护一个`Map`来保存所有在线用户的`WebSocket`连接。由于该`Map`的读取操作远多于写入操作，因此可以选择使用`sync.Map`，也可以通过`sync.RWMutex`手动加锁实现。代码如下：

```go
var clientConnMap = sync.Map{}
```

该`Map`的`Key`用于存储用户的`ID`，通常为`int`或`string`类型，`Value`则对应用户的`*websocket.Conn`对象。用户客户端连接成功时，将其`userId`与`conn`对象放进该`Map`，断开连接时删除。客户端与服务端之间还需设置心跳机制。

