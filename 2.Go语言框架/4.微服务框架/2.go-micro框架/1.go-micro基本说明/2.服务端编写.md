上一节我们使用命令生成了两个文件`pb.go`和`pb.micro.go`，其中`pb.go`的内容在`Grpc`章节有讲过，对于`pb.micro.go`的内容，这个文件主要结构和`grpc.pb.go`类似，不同的地方就是`server`和`client`进行注册的方式不同。先看这个文件里导入的外部包：

<img src="image/image-20240111110921408.png" alt="image-20240111110921408" style="zoom:80%;" />

我们编写服务端的逻辑，我们创建一个`server`文件夹，在下面创建`server.go`文件，它是一个`main`文件：

<img src="image/image-20240111145925482.png" alt="image-20240111145925482" style="zoom:80%;" />

和`gRPC`的逻辑一样，都是定义结构体，实现`pb.micro.go`的`GreeterHandler`接口：

<img src="image/image-20240111111331612.png" alt="image-20240111111331612" style="zoom:80%;" />

```go
import (
	"context"
    "github.com/micro/go-micro/v2"
	"go-micro-test/go-micro/pb/greeter"
)

type Greeter struct{}

func (g *Greeter) Hello(ctx context.Context, req *greeter.HelloRequest, resp *greeter.HelloResponse) error {
	resp.Greeting = "Hello " + req.Name
	return nil
}
```

这里的实现方法看起来很诡异，它的`resp`并没有作为返回值，而是作为方法的参数。

我们先不去管它，先把服务定义出去。在`server.go`文件写以下代码（忽略错误处理）：

```go
func main() {
	// 定义服务，并为其命名
	service := micro.NewService(micro.Name("greeter.server"))
	// 服务初始化
	service.Init()
	// 注册Handler
	greeter.RegisterGreeterHandler(service.Server(), new(Greeter))
	// 启动服务
	service.Run()
}
```

这样服务端就编写好了。

启动`main`方法，可能会遇到如下报错：

![image-20240111145410937](image/image-20240111145410937.png)

这个报错是由于第三方库兼容导致的，在`go.mod`文件中加入如下两行：

```go
replace google.golang.org/grpc => google.golang.org/grpc v1.26.0
replace github.com/lucas-clemente/quic-go => github.com/lucas-clemente/quic-go v0.14.1
```

然后再执行一下`go mod tidy`，重新启动`main`方法就好了。

![image-20240111145731620](image/image-20240111145731620.png)

启动成功。