我们使用这个`protoc`命令编译`proto`文件：

```shell
protoc --go_out=. --go-grpc_out=. user.proto
```

编译后会在指定目录下生成两个文件，分别是`user.pb.go`和`user_grpc.pb.go`。

### 1. `user.pb.go`文件

这个文件包含所有与结构体相关的内容，它会将`proto`文件中的每个`message`转换为`Go`结构体，并将`enum`转换为常量。

我们以此前的`proto`文件编译生成的结构体为例：

```go
type GetUsersRequest struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	UserId   int32  `protobuf:"varint,1,opt,name=user_id,json=userId,proto3" json:"user_id,omitempty"`
	UserName string `protobuf:"bytes,2,opt,name=user_name,json=userName,proto3" json:"user_name,omitempty"`
}

type GetUsersResponse struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	User *User `protobuf:"bytes,1,opt,name=user,proto3" json:"user,omitempty"`
}

type User struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	Id       int32  `protobuf:"varint,1,opt,name=id,proto3" json:"id,omitempty"`
	UserName string `protobuf:"bytes,2,opt,name=user_name,json=userName,proto3" json:"user_name,omitempty"`
	Email    string `protobuf:"bytes,3,opt,name=email,proto3" json:"email,omitempty"`
}
```

可以看到，在`proto`文件中，`message`的字段名使用小写下划线命名规则，而在生成的`Go`结构体中会自动转换为小写驼峰命名。同时，结构体字段会带有`protobuf`和`json`标签，其中`json`标签的每个字段都带有`omitempty`。

每个生成的结构体都带有三个额外的参数，它们的含义如下：

1. `state`：记录消息对象的状态信息，例如是否已被序列化等。
2. `sizeCache`：存储消息对象的大小信息，避免多次计算，一般在序列化时起作用。
3. `unknownFields`：存储未知的字段信息，以便在反序列化时能够保留这些字段。

### 2. `user_grpc.pb.go`文件

这个文件用于实现`gRPC`服务，包含`gRPC`服务端与客户端的代码。其中包括服务端对`user.proto`文件中定义的各个`RPC`方法的具体实现逻辑，以及客户端调用这些方法的相关代码。

以下是`UserService`服务对应的服务端与客户端相关接口代码示例：

```go
type UserServiceClient interface {
	GetUsers(ctx context.Context, in *GetUsersRequest, opts ...grpc.CallOption) (*GetUsersResponse, error)
}

type UserServiceServer interface {
	GetUsers(context.Context, *GetUsersRequest) (*GetUsersResponse, error)
	mustEmbedUnimplementedUserServiceServer()
}
```

我们发现在`UserServiceServer`的接口定义中，多出了这么一个方法：`mustEmbedUnimplementedUserServiceServer()`。

这个方法是`gRPC`自动生成的辅助方法，用于确保在用户定义的`gRPC`服务实现中没有漏实现任何`gRPC`方法。如果结构体没有完全实现接口中定义的所有方法，编译时会报错。

这个文件在后续讲解`gRPC`的`server`代码时还会有更详细的讲解。