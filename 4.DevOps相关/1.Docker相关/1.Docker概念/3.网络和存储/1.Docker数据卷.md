### 数据卷

为什么需要数据卷？首先思考几个问题：

1. 当`docker`容器被删除后，容器中产生的数据会消失。（持久化问题）
2. `docker`容器和外部机器之间无法直接交换数据或文件。（容器与外部通信问题）
3. `docker`容器之间无法直接交换数据或文件。（容器间通信问题）

为了解决这些问题，引入了数据卷的概念。

数据卷是宿主机中的一个目录或文件，与容器内的目录或文件绑定，实现“一方修改，另一方同步修改”。一个数据卷可以被多个容器同时挂载，一个容器也可以同时挂载多个数据卷。

如何配置数据卷？通过`docker run`命令的`-v`参数来指定。例如：

```shell
docker run ... –v /host/config:/container/config ...
```

这样就是把宿主机的`/host/config`目录挂载到容器的`/container/config`目录上。

做数据卷挂载时，需要注意的事项：

1. 宿主机与容器的目录或文件必须使用绝对路径。
2. 数据卷挂载时只能将目录挂载到目录或文件挂载到文件，不支持目录挂载到文件。
3. 如果宿主机目录不存在，将自动创建，这适用于容器启动时需要动态生成内容的目录，例如日志目录。
4. 如果容器目录或文件不存在，将自动创建，并同步宿主机的文件内容。
5. 挂载文件时，宿主机中必须存在该文件，否则宿主机将自动创建一个同名目录，导致挂载失败。
6. 一个容器可以挂载多个数据卷，同时宿主机的一个目录或文件可以挂载到多个容器。
7. 如果宿主机与容器挂载目录下的文件内容不同，容器内的原文件将被删除，宿主机的文件将同步到容器内。

根据注意事项可得结论：如果需要挂载宿主机上不存在但容器内存在的目录或文件（如`conf`目录），应按以下步骤操作：

1. 不使用数据卷挂载，创建一个`docker`容器。
2. 使用`docker cp`命令将容器内的文件或目录拷贝到宿主机。
3. 删除该容器。
4. 启动一个新容器，使用`-v`参数进行对应的数据卷挂载。

> 建议在挂载`Docker`数据卷时，将宿主机的目录路径设置为`/srv/docker`，并根据具体的服务进行分类管理。例如，可以将`MySQL`服务的数据卷挂载到`/srv/docker/mysql`，以便于区分和管理不同服务的数据。

在进行“文件挂载文件”操作时，宿主机文件与容器文件的名称和后缀都可以不同。例如，在创建`Nginx`容器时，可以使用以下命令：

```sh
docker run -d --name nginx \
    -p 80:80 \
    -v /srv/docker/nginx/conf/ng_temp.json:/etc/nginx/nginx.conf \
    nginx
```

此命令将宿主机的`ng_temp.json`文件挂载到容器内的`nginx.conf`文件。这种挂载方式相当于将宿主机`ng_temp.json`文件的内容复制到容器内的`nginx.conf`文件中。如果容器内没有`nginx.conf`文件，则会自动创建它并进行内容复制。

### 数据卷容器

要在多个容器之间共享数据卷，实现数据传递，可以使用数据卷容器。以下是操作步骤和相关解释：

#### 1. 拉取`busybox`镜像

   ```bash
   docker pull busybox
   ```

#### 2. 创建一个数据卷容器

   ```bash
   docker create -v /data --name my_data busybox
   ```

该`/data`目录是挂载在数据卷容器内部的，而不是宿主机。其他容器通过挂载该数据卷容器来共享它们`/data`目录中的数据。

#### 3. 检查数据卷容器：

使用`docker ps -a`可以查看到这个数据卷容器的存在。

#### 4. 创建并启动两个容器，挂载到数据卷容器：

   ```bash
   docker run -d --name nacos_wsj1 --volumes-from my_data nacos/nacos-server
   docker run -d --name nacos_wsj2 --volumes-from my_data nacos/nacos-server
   ```

这两个容器都通过`--volumes-from`参数挂载了`my_data`容器的数据卷。这样，容器中的`/data`目录内容会同步。

### 数据卷容器功能

- 数据同步： 如果在一个容器的`/data`目录中修改了内容，这些修改会同步到其他挂载了相同数据卷的容器中。

- 数据卷容器删除： 即使删除了数据卷容器`my_data`，挂载到该数据卷容器的其他容器仍然可以访问和同步数据。删除数据卷容器不会删除相关的数据卷。使用`docker volume ls`命令可以查看所有数据卷，确认数据卷是否仍存在。

- 数据卷容器的限制： 删除数据卷容器后，其他容器无法再挂载到该数据卷容器上。
