学完了`Dockerfile`，我们用`Dockerfile`进行一个实战。

例如这样的题目：请编写一个`Dockerfile`，用于构建一个基于`Golang`的简单`Web`应用。这个`Web`应用可以是一个简单的`Hello World`程序，你可以使用`Gin`框架或者其他你熟悉的框架。

首先，写出使用`Gin`框架的`hello world`接口代码，文件名为`main.go`：

```go
package main

import (
	"github.com/gin-gonic/gin"
	"net/http"
)

func main() {
	r := gin.Default()
	r.GET("/hello", func(c *gin.Context) {
		c.JSON(http.StatusOK, gin.H{
			"message": "Hello, World!",
		})
	})
	err := r.Run(":8080")
	if err != nil {
        log.Fatal(err)
	}
}
```

然后完成`Dockerfile`文件编写（这里的内容未经优化）：

```sh
FROM golang:1.21

SHELL ["/bin/bash", "-c"]

WORKDIR /app

COPY . .

ENV GOPROXY=https://goproxy.cn,direct

RUN go mod init example.com/mundo

RUN go mod tidy

RUN go mod download

RUN go build -o main .

CMD ["./main"]
```

把`main.go`和`Dockerfile`放到同一个宿主机文件目录下，执行下面命令构建镜像：

```shell
docker build -t mundo:1.0 .
```

这里的`-t`是`--tag`的简写，用于为生成的镜像添加标签。`mundo`表示镜像名称，`1.0`表示镜像版本号，其格式为`<name>:<tag>`。如果未指定版本号，则默认使用`latest`。点号表示构建的上下文路径，这里为当前目录，即查找`Dockerfile`文件所在的目录。

首次打镜像可能较慢，我们打了一个名为`mundo:1.0`的镜像，成功后我们使用`docker images`查看它。

启动一个该镜像的容器：

```shell
docker run -d -p 8080:8080 mundo:1.0
```

然后可以通过浏览器或`Postman`访问宿主机`IP`的`8080`端口下的`/hello`路径，即可看到`Hello, World!`的输出。

一般情况下，会将镜像上传到`DockerHub`或本地镜像仓库，供其他`Linux`环境的`Docker`使用。但如果不想上传到公共平台，而是仅打包后提供给其他服务器使用，该怎么办呢？

我们使用下面这个命令，把镜像保存到文件中（如果文件较大，可能耗时较长，耐心等待）：

```sh
docker save mundo:1.0 > mundo1.0.tar
```

这里的`> mundo1.0.tar`代表我们要将镜像`mundo:1.0`保存到当前目录下名为`mundo1.0.tar`这个文件中。

把这个`mundo1.0.tar`文件传到另一个`Linux`里后，使用下面命令进行解压（这里`-i`是`input`的缩写）：

```sh
docker load -i mundo1.0.tar
```

先使用`docker images`查看该镜像是否存在，确认存在后即可通过`docker run`命令创建容器。使用`docker load`导入的镜像，其名称和版本号与执行`docker save`打包镜像时保持一致。

我们也可以给解压后的镜像进行重新打标签，例如当前镜像信息是这样的：

```sh
REPOSITORY   TAG   IMAGE ID      CREATED        SIZE
mundo        1.0   87a0c5e0cabb  3 months ago   1.19GB
```

使用以下命令给镜像重新打标签，并删除原来的镜像：

```sh
docker tag mundo:1.0 mundo-img:2.0 && docker rmi mundo:1.0
```

删除镜像不能使用`IMAGE ID`，因为新的标签和旧的标签共用同一个`IMAGE ID`。

操作完成后，镜像信息如下所示：

```sh
REPOSITORY   TAG   IMAGE ID      CREATED        SIZE
mundo-img    2.0   87a0c5e0cabb  3 months ago   1.19GB
```

