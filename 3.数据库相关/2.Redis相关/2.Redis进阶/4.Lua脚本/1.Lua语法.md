`Redis`的事务可以分为入队阶段与执行阶段：

- 在入队阶段（`MULTI`到`EXEC`之间），事务中的命令只是被加入队列，并未真正执行，在此期间相关`Key`仍可能被其他客户端自由修改。如果在入队阶段出现语法级错误，后续执行`EXEC`将直接失败，队列中的命令不会被执行。

- 在执行阶段（`EXEC`开始后），多条`Redis`命令作为一个整体原子执行，且执行过程中不会被其他客户端的命令穿插执行，对外仅暴露执行前或执行后的最终状态。但`Redis`事务没有提供类似`MySQL`事务的统一提交或统一回滚能力，一旦进入执行阶段，如果某一条命令发生运行期错误，已经成功执行的命令不会被回滚，且后续命令仍然会继续执行。

`Lua`是一门编程语言，具备独立的语法规则，作为脚本存在。`Redis`的`Lua`脚本相比`Redis`事务，增加了以下特性：

1. 脚本执行过程完全原子性，期间其他客户端的命令会被阻塞，从而保证严格的隔离性。
2. 脚本执行过程中遇到错误会立即停止后续命令执行，并退出脚本，但已执行的命令不会回滚。
3. 脚本的业务逻辑在`Redis`内部一次性完成，从而可避免多次网络往返带来的性能损耗。
4. 脚本支持`if`、`for`、`while`等控制结构，以及局部变量、函数调用等语言特性，可完成复杂的条件判断与分支处理。

下面讲解一下`Lua`的基础语法：

待办
