`Redis`的三大集群模式分别是主从复制模式、哨兵模式和`Cluster`模式。这些集群模式解决了高可用性、扩展性和数据一致性问题，适应不同规模和需求的应用场景。

### 1. 主从复制模式

主从复制模式是`Redis`最基础的集群模式，通过主节点负责写操作、从节点负责读操作，实现读写分离。主从节点之间保持数据一致性，从而在提升系统整体性能的同时，增强系统的高可用性与容错能力。

主节点和从节点的概念如下：

- 主节点（`Master`）：是集群中的核心节点，负责处理所有写操作，如`SET`、`DEL`等，并将所有的数据更新同步给从节点。

- 从节点（`Slave`）：作为主节点的只读副本，只能处理读请求，如`GET`操作，并始终保持和主节点的数据一致性。

一个主节点可以有多个从节点，这些从节点可以分布在不同的物理机器上。主从复制模式的工作架构图如下：

<img src="image/734446-20230423104604712-958561171.png" alt="image" style="zoom:30%;" />

### 2. 哨兵模式

哨兵模式是在主从复制的基础上，通过引入哨兵节点（`Sentinel`）对`Redis`主从集群的运行状态进行监控，实现自动故障检测、主从切换以及事件通知等能力。其核心特性在于，当主节点发生故障时，系统能够自动完成主节点切换，显著降低服务中断时间。

哨兵模式的监控过程如下：

1. 哨兵节点会持续监控主节点和从节点的运行状态，定期通过`PING`命令检测各个`Redis`实例是否能够正常响应。如果某个节点在指定时间内持续无响应，则会被判定为不可用。
2. 当哨兵检测到主节点发生故障时，会触发主节点选举流程，从现有从节点中选出新的主节点，并将集群中其余从节点重新配置为指向该新主节点。整个切换过程由系统自动完成，无需人工介入。
3. 哨兵会向客户端发送通知，告知其主从节点的变更情况。客户端可及时更新主节点地址，确保写操作能够正确路由到新的主节点。

哨兵本身是一个独立进程，如果仅部署单个哨兵节点，一旦其发生故障，系统的高可用性将无法得到保障，同时单个哨兵无法完成主节点选举工作。因此，通常需要部署多个哨兵节点，组成哨兵集群，以提升系统的稳定性与可靠性。

哨兵模式的工作架构图如下：

<img src="image/734446-20230423104619091-219085123.png" alt="image" style="zoom:30%;" />

### 3. `Cluster`模式

`Cluster`模式是`Redis`的一种去中心化、分片式集群方案。在主从复制模式和哨兵模式中，集群中仅存在一个主节点，所有数据都集中存储于该节点；而在`Cluster`模式下，集群由多个主节点组成，每个主节点仅负责存储其中一部分数据。`Redis`通过哈希槽机制将所有键值对分布到不同节点上，借助数据分片能力，`Cluster`模式能够支持更大规模的数据存储与访问。

主从复制模式侧重于读写分离，而在`Cluster`模式中，主节点同时承担读写请求。每个主节点会配置一个或多个从节点，从节点保存对应主节点数据的完整副本。当主节点不可用时，从节点会选举出新的主节点，新主节点接管哈希槽和客户端请求，而原主节点恢复后会作为从节点重新加入集群，以保证集群的持续可用性。

如果集群中超过半数的主节点不可用，集群将进入不可写状态，避免在大量节点失效的情况下出现数据丢失或不一致的问题。

`Cluster`通过哈希槽（`Hash Slots`）机制实现数据分片，具体规则如下：

1. `Cluster`会对所有数据键使用`CRC16`算法计算哈希值，并对`16384`取模，得到对应的哈希槽编号，范围为`0`到`16383`。每个主节点负责管理其中一部分哈希槽，从而提升数据访问效率，并避免单个节点负载过高。
2. 当`Cluster`接收到客户端操作请求时，会根据数据键计算其所属的哈希槽，并定位负责该哈希槽的主节点，随后由客户端与该主节点直接通信完成读写操作。
3. 从节点作为主节点的副本，负责复制主节点的数据。当主节点所管理的某个哈希槽中的数据发生变化时，对应的从节点会同步更新。从节点本身不管理哈希槽，也不直接处理客户端的读写请求，除非在主节点发生故障后晋升为新的主节点。

`Cluster`模式的工作架构图如下：

<img src="image/734446-20230423104631153-1328078427.png" alt="image" style="zoom:30%;" />