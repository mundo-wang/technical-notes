上一节我们介绍了`MongoDB`文档的结构，并了解到文档本质上是一个类似于`JSON`对象的键值对集合。本节将进一步讲解`MongoDB`的其他相关概念，并探讨它与关系型数据库`MySQL`的对应关系。

### 1. 集合

在`MongoDB`中，集合相当于关系型数据库中的表，它是文档的容器，一个集合包含一组文档。

与传统的关系型数据库表不同，`MongoDB`的集合是无模式（`schema-less`）的，不要求所有文档具有相同的字段结构或数据类型。这意味着，你可以在同一个集合中存储结构不同的文档，例如：

```json
{ "name": "Alice", "age": 25 }
{ "name": "Bob", "address": "New York" }
```

集合的命名必须遵循以下规则：名称只能包含字母（`a-z`、`A-Z`）、数字（`0-9`）、下划线（`_`）和点号（`.`）。特殊字符（如`$`等）不允许使用，因为它们可能被`MongoDB`保留用于内部操作（例如`$`用于操作符）。此外，集合名不能以`system.`开头，这是`MongoDB`专门为系统集合（如`system.indexes`）保留的命名空间。集合名的长度不得超过`120`字节，并且大小写敏感。例如，`users`和`Users`会被视为两个不同的集合。

在`MongoDB`中，并不存在原生的“子集合”概念。虽然集合名中可以使用点号，但由于点号通常用于分隔数据库名和集合名，为避免混淆，建议尽量避免在集合名中使用。在某些备份工具或操作中，点号可能被误解为分隔符，例如，`app.logs`可能被错误解析为数据库`app`中的集合`logs`。

推荐使用`snake_case`来模拟子集合的概念，这样这些“子集合”可以被命名为：

- `product_electronics`
- `product_clothing`
- `product_books`

在`MongoDB`中，每个集合实际上是完全独立的，彼此之间并不存在父子关系。数据的插入、查询和管理操作仍需明确指定集合名称，无法通过命名结构隐式关联。

虽然`MongoDB`允许集合中存放不同类型的文档，但将文档合理划分到不同集合通常能提升性能和维护性，原因如下：

1. 提高查询效率：将不同类型的文档存储在独立集合中，可避免全表扫描，提升查询针对性和性能。
2. 便于管理维护：混合存储会导致集合过大、管理复杂。按类型拆分能更清晰组织数据，方便备份、监控和优化。
3. 增强可扩展性：针对增长较快的文档类型（如日志），可设计专门的存储和索引策略，优化性能并保持系统扩展能力。

### 2. 数据库

在`MongoDB`中，多个文档组成一个集合，而多个集合组成一个数据库。一个`MongoDB`实例（即一个运行中的`MongoDB`服务）可以承载多个数据库。每个数据库在物理磁盘上是独立存储的，`MongoDB`会为每个数据库创建一个独立的文件夹来存储相关数据文件。

`MongoDB`中有三个系统数据库：`admin`、`local`和`config`。它们有特殊的用途和管理功能，不是普通业务数据库中的一部分。

1. `admin`数据库：是`MongoDB`的核心权限管理数据库，用户、角色和权限在此数据库中定义和管理。将用户分配到`admin`数据库后，该用户通常会继承对所有数据库的访问权限，具备全局管理能力。

2. `local`数据库：是`MongoDB`中的特殊数据库，它的数据只存在于单个节点上，不会在副本集中进行复制。这个数据库通常用来存储与实例相关的本地数据和日志信息，比如副本集的操作日志或选举日志。

3. `config`数据库：用于`MongoDB`的分片集群，存储分片信息、路由表和数据分布的元数据。它帮助`mongos`路由进程决定数据的存储位置和分片范围，确保集群内数据的有效分布和访问。

### 3. 命名空间

在`MongoDB`中，命名空间是用于唯一标识集合的一个重要概念。通过命名空间的形式，可以清晰地表明集合所属的数据库以及集合的名称，从而实现数据的逻辑组织和区分。命名空间的结构如下：

```sh
<database>.<collection>
```

其中`<database>`表示数据库名称，`<collection>`表示集合名称。通过`.`连接`<database>`和`<collection>`，形成了唯一标识一个集合的命名空间。在同一个`MongoDB`实例中，`<database>`和`<collection>`组合形成的命名空间是唯一的。

假设有一个数据库名为`ecommerce`，其中包含`product`、`order`、`customer`这三个集合，那么这些集合的命名空间为：

1. `ecommerce.product`
2. `ecommerce.order`
3. `ecommerce.customer`

### 4. 索引

在`MongoDB`中，索引通过减少扫描文档数量显著提高查询性能，类似书籍的目录，可以快速定位目标内容。利用索引，数据库能够直接定位匹配的文档，无需遍历整个集合，并能加速查询结果的排序操作。若无索引，随着数据量增加，查询性能会大幅下降。`MongoDB`的索引基于`B`树结构，支持高效的查找、插入和删除操作，时间复杂度为对数级。

`MongoDB`的常见索引类型包括：单字段索引、复合索引、唯一索引、文本索引、地理空间索引、哈希索引、稀疏索引等。

`MongoDB`的索引是针对集合中的字段创建的，即使集合中的文档结构不完全一致（如某些文档缺少该字段），索引依然可以正常创建。对于不存在目标字段的文档，索引会自动跳过，既不会影响这些文档的存储，也不会干扰其他查询操作。这意味着索引仅作用于包含目标字段的文档，从而在提升相关查询性能的同时，保持对集合中其他文档的兼容性。

与`MySQL`类似，`MongoDB`的索引也会占用额外的存储空间，并在文档插入、更新或删除时需要同步更新相关索引。这种操作会增加写入开销，从而降低写入性能。因此，索引应优先为频繁查询的字段创建，避免创建过多不必要的索引。
