索引是一种用于提高数据库表检索效率的数据结构。通过创建索引，`MySQL`可以直接定位到特定行，而不必扫描整张表，从而显著降低了数据检索的时间复杂度。此外，索引还能减少排序操作的成本，从而降低了`CPU`的消耗。

在`InnoDB`存储引擎中，索引以`B+`树的形式存储在磁盘上。当我们创建索引（无论是主键、唯一索引还是普通索引）时，`MySQL`会将索引数据持久化到表空间文件中，通常是以`.ibd`为后缀的文件，以便在重启后仍能使用这些索引。

为了提升查询性能，`MySQL`会将频繁访问的索引页缓存在`InnoDB`的缓冲池（`Buffer Pool`）中，该缓冲池位于内存。也就是说，热点索引页会被加载进内存以加快访问速度，而不常用的索引页则仍保留在磁盘上，只有在需要时才会被动态加载到内存中。

### 一、索引相关命令

下面讲解非主键字段创建普通索引的方式：

#### 1. 创建索引

```sql
create index 索引名 on 表名(字段名);
```

#### 2. 在建表同时创建索引

```mysql
CREATE TABLE 表名 (
    ...
    INDEX 索引名 (字段名)
);
```

#### 3. 查看表中所有索引

```sql
show index from 表名; 
```

#### 4. 删除索引

```sql
drop index 索引名 on 表名;
```

#### 5. 查看表中某一字段是否有索引

```sql
SHOW INDEX FROM 表名 WHERE Column_name = '字段名';
```

如果有索引，会展示具体索引信息；如果无索引，展示空值。

### 二、索引的缺点

1. 索引会占用额外的存储空间，增加了数据存储的需求。
2. 在进行插入、更新或删除操作时，索引需要同步维护，可能导致写入性能下降，尤其是在数据频繁变动的表中更为明显。
3. 在高并发写入场景下，索引可能引发锁竞争，进而影响系统的整体并发性能。

### 三、`MySQL`为什么使用`B+`树索引

`MySQL`选择使用`B+`树作为索引结构，主要是因为相比于`B`树，`B+`树在数据库应用中具有以下明显优势：

1. `B+`树将所有数据存储在叶子节点，非叶子节点仅存储键和指向子节点的指针，这提升了分支因子（即每个节点可拥有的最大子节点数），有效降低了树的高度。这意味着每次访问磁盘时可以跳过更多无关数据，显著减少`IO`次数，提升整体查询性能。
2. `B+`树的叶子节点通过有序的双向链表连接，因此可以从任意叶子节点顺序遍历后续节点，天然支持范围查询操作（如`BETWEEN`、`>`、`<`等）。而`B`树的叶子节点之间没有链表连接，无法直接顺序遍历，只能依赖回溯或中序遍历来实现范围查询。
3. 由于`B+`树的非叶子节点仅存储键和指向子节点的指针，不包含实际数据，因此占用的内存空间更小。这样可以在同一内存页或`Buffer Pool`中加载更多的非叶子节点，从而提高缓存命中率，进一步减少磁盘访问次数，提升查询性能。
4. `B+`树将所有数据集中存储在叶子节点，因此，在执行插入、删除等结构变更操作时，只需调整非叶子结点的键和指针，不会涉及实际数据的移动。这样不仅降低了操作代价，也更容易维护树的平衡状态。
5. `B+`树将所有数据集中存储在叶子节点，所有查询操作最终都需要访问叶子节点，这确保了读取路径的一致性。这样的结构便于在读写优化和并发控制方面进行统一处理，例如更好地与`MVCC`、`Redo Log`等机制配合，提高系统的性能和可靠性。

### 四、`MySQL`的索引越多越好吗？

`MySQL`中的索引并不是越多越好，索引过多反而可能带来以下问题：

1. 每次执行插入、更新或删除操作时，所有相关索引都需要同步维护，索引越多，写入性能越差。
2. 过多的索引会占用更多磁盘空间，导致存储成本上升。
3. 为提升查询性能，索引通常需要加载到内存中，索引数量过多可能导致内存压力增大，影响系统整体性能。
4. 查询时，数据库优化器会在多个索引之间进行评估，以选择最优的执行计划，索引越多，评估成本越高，反而可能降低查询效率。
5. 索引数量越多，数据库的维护复杂度也随之增加，例如在备份、恢复、迁移等操作中，索引会显著影响执行效率与操作时长。

