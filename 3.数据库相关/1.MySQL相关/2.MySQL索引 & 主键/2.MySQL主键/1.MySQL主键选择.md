### 1. 主键`ID`的要求 

在分布式微服务环境中，对于表的主键`ID`有以下这些要求，它们不一定要全部满足，需要自行取舍：
1. 全局唯一性：确保在整个系统中每个主键值都是唯一的，以避免数据冲突和一致性问题。
2. 单调递增：主键要使用有序的，且保证下一条数据的`ID`一定大于上一条数据的`ID`。
3. 信息安全：在一些敏感场景下，考虑主键的无规则性，避免恶意爬取和泄露数据量等问题。
4. 含时间戳：主键最好包含生成时的时间信息，便于开发者在开发和调试时追踪数据生成的时间顺序。
5. 性能要求：`ID`生成的性能必须足够高，不能成为系统的瓶颈。`ID`的长度应适中，避免过长导致存储和传输开销大。

### 2. `UUID`

`UUID`（通用唯一标识符）是一种全局唯一的标识符，通常由`32`个`16`进制数字组成，按`8-4-4-4-12`的格式分组。例如：`28ab278b-641b-4ff9-b430-d13a6772c5a1`。

#### 2.1 `UUID`的优点

1. 高性能：本地生成，无需网络请求，生成速度快。
2. 唯一性：基于时间戳和随机数生成，重复概率极低。
3. 安全性：不易被猜测或破解，适用于需要安全性的场景。
4. 分布式环境友好：各节点可以独立生成`UUID`，避免因网络延迟或其他问题导致的`ID`冲突。
5. 标准化：`UUID`格式规范统一，跨系统兼容性强。

#### 2.2 `UUID`的缺点

1. 插入性能：由于`UUID`的无序性，插入数据库时可能导致索引结构频繁重组，从而影响性能。
2. 存储空间：`UUID`较长，占用较多存储空间，尤其是作为主键时，索引表会显著增大。
3. 查询效率：由于长度和无序性，基于`UUID`的查询效率较低，相比自增`ID`等有序主键查询速度较慢。
4. 可读性差：`UUID`不易阅读和记忆，不适合用作展示或输入。

### 3. 自增主键

在数据库中，自增主键是一种自动递增的整数值，用于简单地唯一标识数据库表中的每一行记录。

#### 3.1 自增主键优点

1. 简单易用：数据库自动管理主键值的生成和唯一性，开发者无需手动处理。
2. 性能优化：插入操作效率高，数据库引擎优化了自增列的索引结构，减少了额外的索引维护开销。

#### 3.2 自增主键缺点

1. `ID`冲突风险：在某些情况下，如分布式系统中，如果自增序列不稳定或多节点生成`ID`时未同步，可能导致`ID`冲突。
2. 系统扩展限制：在分表情况下，需要考虑多张表的起始`ID`值的设置，以及涉及到表合并的操作时，可能会导致主键冲突。
3. 单点故障：如果自增序列生成器所在节点发生故障，整个系统的写入操作可能受到影响，需要额外的冗余和恢复策略来处理。

### 4. 雪花算法
雪花算法用于生成分布式系统中的唯一`ID`，其生成的`ID`按时间有序递增，是一个`64bit`大小的整数，由以下几部分组成：

- `1bit`符号位（始终为`0`，保证生成的是正数）。
- `41bit`时间戳（精确到毫秒级）。
- `10bit`工作机器`id`。
- `12bit`序列号。

由于该`64`位二进制数的最高位始终为`0`，所以这个二进制数的最大值为：

<img src="image/image-20250122155821077.png" alt="image-20250122155821077" style="zoom:70%;" />

共`19`位，所以就代表雪花算法最多可以生成`19`位十进制数字。一个示例为：`1881976623637467136`。

#### 4.1 雪花算法优点

1. 高性能：本地生成，无需网络请求，生成速度快。支持高并发的`ID`生成需求，每秒可生成数百万个唯一`ID`。
2. 分布式特性：可以在分布式环境中运行，多个节点可以同时生成`ID`而不会发生冲突，适用于大规模分布式系统。
3. 时间有序：生成的`ID`是按时间递增的，便于数据库索引的优化，避免了插入时的性能问题。
4. 简单易用：算法相对简单，易于实现和部署。

#### 4.2 雪花算法缺点

1. 时钟回拨问题：依赖于机器的时钟，如果机器时钟发生回拨，可能会导致重复`ID`的生成。
2. 机器`id`位数限制：限制了单数据中心可部署的机器数量，最多支持`1024`台机器。
3. 序列号位数限制：同一毫秒内生成`ID`的数量有限，最多支持每台机器每毫秒生成`4096`个`ID`，超过则会等待下一毫秒再生成。


### 5. 如何选择
- 自增`ID`：适用于单体系统或小规模系统，例如个人项目、小型企业应用，以及不需要跨多个节点生成唯一`ID`的系统。
- `UUID`：适合需要全局唯一性和安全性的分布式系统，例如大规模分布式系统、安全要求较高的系统，以及需要在不同系统之间传递唯一标识的场景。
- 雪花算法：适合高并发和需要时间有序的分布式系统，例如互联网应用、微服务架构下的系统，以及需要在分布式环境中快速生成唯一`ID`的场景。