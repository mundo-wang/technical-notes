### 事务及其四个特性（`ACID`）

事务是指一组作为单个逻辑单元执行的一系列操作，这些操作要么全部成功，要么全部回滚。事务主要涉及`DML`语句，因此可以理解为绑定在一起的多条`DML`语句同时成功或失败。

事务的四个特性（`ACID`）包括：

1. 原子性（`Atomicity`）：一个事务中所有`DML`操作，要么同时成功要么全部失败回滚，不会出现部分成功的情况。
2. 一致性（`Consistency`）：事务在执行前后，数据库必须处于符合所有约束规则的合法状态，包括数据库约束、业务逻辑约束等。
3. 隔离性（`Isolation`）：事务之间的隔离级别包括：读未提交、读已提交、可重复读、序列化。
4. 持久性（`Durability`）：事务结束后的修改数据永久保存在数据库中，即使系统故障数据也不会丢失。

### 事务的四种隔离级别

#### 1. 读未提交（`Read Uncommitted`）

最低的隔离级别。写事务`A`还未提交的数据就被读事务`B`读取，这会导致脏读问题。

> 脏读（`Dirty Read`）是指一个事务读取了另一个尚未提交的事务所修改的数据。如果该未提交事务随后回滚，被读取的数据便成为无效的脏数据。

#### 2. 读已提交（`Read Committed`）

写事务`A`提交后，读事务`B`才能读取到写事务`A`提交的数据。这解决了脏读问题，但未解决不可重复读的问题。

> 不可重复读（`Non-repeatable Read`）指同一事务在前后两次读取同一数据时，由于其他事务在此期间完成了更新并提交，导致两次读取结果不一致。例如，事务`T1`首次读取`id=1`的用户余额为`100`；期间事务`T2`将该行余额更新为`200`并提交；当事务`T1`再次读取该用户余额时，读到的结果变为`200`。

#### 3. 可重复读（`Repeatable Read`）

在开启读事务`B`时，相当于给当前读取的数据范围加了写锁。在读事务`B`提交之前都不会释放写锁，这样之后读取到的数据值不会变化，解决了不可重复读的问题，但未解决幻读（`Phantom Read`）的问题。

> 幻读（`Phantom Read`）指同一事务在前后两次按相同条件查询数据时，由于其他事务在此期间对该查询范围内的数据进行了新增或删除操作，导致两次查询的结果集不一致。例如，事务`T1`首次查询余额大于`0`的用户共`10`条；其间事务`T2`插入一条余额大于`0`的新用户并提交；当事务`T1`再次执行相同查询条件时，结果变为`11`条。
>
> 不可重复读主要关注数据值的变化（修改），而幻读则关注数据行数的变化（增删）。

`MySQL`的默认事务隔离级别为可重复读，`PostgreSQL`和`Oracle`的默认事务隔离级别为读已提交。

#### 4. 序列化（`Serializable`）

数据库事务的最高隔离级别。在此级别下，事务串行执行，一个事务提交后，另一个事务才可以开启。可以避免脏读、不可重复读、幻读等问题，但效率低下，耗费数据库性能，不推荐使用。