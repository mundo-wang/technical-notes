这是`2022`年下半年我秋招的时候做的一套笔试题，里面的`SQL`题目出的比较有水平，我在此做记录。

先给出这四张表的建表`DDL`：

```sql
CREATE TABLE `t_order` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `user_id` INT NOT NULL,
    `goods_id` INT NOT NULL,
    `goods_num` INT NOT NULL,
    PRIMARY KEY (`id`)
);

CREATE TABLE `t_user` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `mobile` VARCHAR(18) NOT NULL,
    `nick_name` VARCHAR(100) NOT NULL DEFAULT '',
    PRIMARY KEY (`id`)
);

CREATE TABLE `t_goods` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `store_id` INT NOT NULL,
    `goods_name` VARCHAR(100) NOT NULL,
    `goods_type` VARCHAR(100) NOT NULL,
    `goods_price` DOUBLE,
    PRIMARY KEY (`id`)
);

CREATE TABLE `t_store` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `store_name` VARCHAR(100) NOT NULL,
    PRIMARY KEY (`id`)
);
```

#### 第一题：查询所有商品名称为“`Java`编程思想”且店铺名称为“天天出版社”的订单`ID`。

```sql
SELECT a.id AS order_id
FROM t_order a
INNER JOIN t_goods b ON a.goods_id = b.id AND b.goods_name = 'Java编程思想'
INNER JOIN t_store c ON b.store_id = c.id AND c.store_name = '天天出版社';
```

#### 第二题：查询购买商品类型最多的三位用户的昵称，类型数量相同则按照昵称升序排序。

```sql
SELECT d.nick_name
FROM (
    SELECT c.nick_name, b.goods_type
    FROM t_order a
    INNER JOIN t_goods b ON a.goods_id = b.id
    INNER JOIN t_user c ON a.user_id = c.id
) d
GROUP BY d.nick_name
ORDER BY COUNT(d.goods_type) DESC, d.nick_name ASC
LIMIT 3;
```

#### 第三题：为所有价格超过`100`元的商品打五折，如果打折后小于`100`则置为`100`。

```sql
UPDATE t_goods
SET goods_price = (
    CASE
        WHEN goods_price > 100 AND goods_price < 200 THEN 100
        WHEN goods_price > 200 THEN goods_price * 0.5
        ELSE goods_price
    END
);
```

#### 第四题：查询所有订单中商品总额（商品数量*商品价格）大于`500`的用户昵称（去重）。

第一种写法：

```sql
SELECT DISTINCT c.nick_name
FROM t_order a
LEFT JOIN t_goods b ON a.goods_id = b.id
LEFT JOIN t_user c ON a.user_id = c.id
WHERE a.goods_num * b.goods_price > 500;
```

第二种写法：

```sql
SELECT DISTINCT c.nick_name
FROM t_order a
INNER JOIN t_goods b 
    ON a.goods_id = b.id 
    AND a.goods_num * b.goods_price > 500
LEFT JOIN t_user c 
    ON a.user_id = c.id;
```

#### 第五题：哪些店铺的类型为“书籍”的商品平均价格高于系统中所有书籍商品的平均价格，查询这些店铺的名字，按平均价格高低排列。

```sql
SELECT a.store_name
FROM t_store a
INNER JOIN t_goods b ON a.id = b.store_id
WHERE b.goods_type = '书籍'
GROUP BY a.id, a.store_name
HAVING AVG(b.goods_price) > (
    SELECT AVG(goods_price)
    FROM t_goods
    WHERE goods_type = '书籍'
)
ORDER BY AVG(b.goods_price) ASC;
```

