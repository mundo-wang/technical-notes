下面是在`Linux`上直接安装`Nginx`后，`/usr/local/nginx/conf`目录下`nginx.conf`文件的具体内容：

```nginx
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   html;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}
```

> 在`Nginx`配置文件中，官方对缩进并没有硬性要求，既可以用`tab`，也可以用空格，我们建议统一使用空格。

这是`Nginx`的最小可用`HTTP`服务配置，用于本地测试静态页面。`worker_processes`用于配置`Nginx`的`worker`进程数量，默认值为`1`。在生产环境中，通常将其设置为`auto`，即与`CPU`核心数保持一致，以便充分利用多核性能。`events`块用于控制连接的处理方式，其中`worker_connections 1024`表示每个`worker`进程最多可同时处理`1024`个连接。

`http`块用于配置`HTTP`协议相关内容。其中，`include`指令用于引入与`nginx.conf`同目录下的`mime.types`文件，该文件定义了文件扩展名与`MIME`类型的对应关系，用于告诉`Nginx`在响应不同类型文件时应使用的`Content-Type`。当文件类型无法在`mime.types`中匹配时，`default_type`会指定默认类型为`application/octet-stream`，即以二进制流形式进行下载。`sendfile on`用于开启`sendfile`零拷贝机制，以提升文件传输性能；`keepalive_timeout 65`则表示长连接的保持时间为`65`秒。

`http`块下的`server`块用于定义虚拟主机，用来配置监听端口、域名、文件目录以及错误处理等内容。在上述配置中，它监听`80`端口，即`HTTP`协议的默认端口，并将服务器域名设置为`localhost`，表示仅响应访问`http://localhost/`的请求。在生产环境中，可以将其配置为具体的`IP`地址或实际的域名地址。

`location`用于定义请求路径的匹配与处理规则，采用前缀匹配原则。例如，`location /`中的`/`是所有路径的最小公共前缀，请求`/`、`/xxx`、`/xxx/yyy`等都会匹配此规则。除非有更具体的`location`配置，否则这些请求会由此规则处理。

如果需要进行精确路径匹配，可以使用`location = /`，它享有最高优先级，但访问路径必须完全一致。除此之外，还存在一种高优先级前缀匹配，写作`location ^~ /`，只要该规则匹配成功，就会直接采用该配置，并跳过其他前缀匹配以及正则匹配。

对于下面的`Nginx`配置来说：

```nginx
location /static/html {
    # 普通前缀匹配
}

location ^~ /static {
    # 高优先级前缀匹配
}
```

当请求路径为`/static/html/test`时，即使`location /static/html`在所有可匹配的前缀规则中是最长匹配项，请求仍然会被路由到高优先级前缀匹配的`location ^~ /static`。

`root`指令用于设置网站的根目录。如果设置为相对路径，则该路径相对于`Nginx`的安装目录。`index`指令则用来指定默认访问文件的优先级顺序，当访问`http://localhost/`时，`Nginx`会依次查找并返回`html/index.html`或`html/index.htm`文件。

但需要注意的是，对于带路径的请求，如`http://localhost/about`，如果该请求被路由到`location /`，`Nginx`会尝试查找并返回`html/about/index.html`或`html/about/index.htm`，可能导致找不到文件，返回`404`。

`error_page`部分用于指定当服务器返回`500`、`502`、`503`或`504`错误时，返回自定义的错误页面`50x.html`。其下方的`location`用于定义当请求完全匹配`50x.html`时，`Nginx`应在安装目录下的`html`文件夹中查找并返回该页面。

使用`Docker`安装`Nginx`容器后，在`/srv/docker/nginx/conf`目录下的`nginx.conf`文件具体内容如下：

```nginx
user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log notice;
pid        /run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;
    sendfile        on;
    keepalive_timeout  65;

    include /etc/nginx/conf.d/*.conf;
}
```

我们可以看到，该配置文件引入了宿主机`etc/nginx/conf.d`目录下的所有`.conf`文件。该目录已被挂载到宿主机的`/srv/docker/nginx/conf.d`目录下。在这个目录中，我们可以看到一个名为`default.conf`的文件，其内容如下：

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
```

该配置文件相比直接安装的`Nginx`默认配置文件，仅新增了日志配置和`IPv6`端口监听。同时，将`server`配置独立成单独文件放置于`conf.d`目录下，使配置管理更加便捷。后续讲解中，将以`Linux`直接安装`Nginx`的配置文件为基础进行修改。
